---
title: "Genexpressie van L. plantarum WCFS1 bij glucose en ribose"
author: "Teun van Dorp, Luc Hengeveld, Michelle Memelink"
date: "20/11/2020"
output: html_document
---
### ALgemeen doel
Het doel is om te onderzoeken of er verschil is in genexpressie bij de bacterie
Lactobacillus plantarum WCFS1, als deze op verschillende voedingsbodem groeit.
De twee gebruikte soorten voedingsbodem bevatten of glucose of ribose. Er is op 
beide bodem twee keer een experiment uitgevoerd. De resultaten die hieruit 
volgende worden gebruikt in dit onderzoek. De resultaten die door middel van 
deze code verkregen worden hebben dus betrekking op die resultaten. Uit deze 
resultaten kan uiteindelijk afgeleid worden of er verschil in genexpressie is. 
  
  ```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Ophalen blibliotheken
De benodigde blibliotheken worden aangroepen. <br>  
Output: welke package is ingeladen.
```{r aanroepen libraries}
library(edgeR)
```

### Bestand open en inlezen
De locatie van het bestand dat uitgelezen moet wordt, wordt aangegeven en de naam
van het bestand wordt aangegeven, deze wordt tevens ingeladen. Vervolgens wordt het
bestand ingelezen en worden alle ID's van de genen eruit gehaald. Ook wordt erin 
een andere vector de namen opgeslagen van de verschillende experimenten, dit zijn 
de kolomnamen. 

```{r aanmaken}
fDir <-  "/Users/Michelle Memelink/Documents/HAN jaar 2/Blok 2/Tutor/"
fName <- "WCFS1_cnts.txt"
cnts <- read.delim(paste0(fDir,fName), comment.char="#")
row.names(cnts) <- cnts[,"ID"]
exp <- c("WCFS1.glc","WCFS1.glc","WCFS1.rib","WCFS1.rib")
```

### DGElist aanmaken
Er wordt een DGElist gemaakt, door gebruik te maken van EdgeR. Het is een lijst 
welke de genen bevat die geanaylseerd moeten worden. De aangemaakt vector welke 
de kolomnamen bevat wordt meegegeven voor het maken ven de DGElist. 
```{r DGElist aanmaken}
group <- factor(exp)
y <- DGEList(counts=cnts[,2:5],group=group)
```

### Normaliseren
De waardes worden genormaliseerd. Dit wordt gedaan door het bijsnijden van de 
gemiddelde van M-waarden: verwijder de laagste en hoogste waarden.
```{r normaliseren}
y <- calcNormFactors(y, method="TMM" )
```

### Controleren van data
Er wordt gekeken of de data juist. Er wordt gecontroleert of het inlezen
en normaliseren op de juiste wijze is verlopen. <br>  
Output: de eerste grafiek bestaat uit een samenvatting per experiment. De tweede 
grafiek bevat een kolom met de naam van de experiment. De twee kolom bevat de 
algemene namen van de condties (welke voedingsbodem). Daarna een kolom wat de 
sequentiediepte/bibliotheekgroottes voor elk conditie bevat. De laatste kolom 
bevat normalisatie factor waardes. 
```{r controleren van data}
print(summary(y$counts))
print(y$samples)
```


### Matrix aanmaken
Er wordt een matrix gemaakt. Er wordt aangegeven welke kolom welk experiment bevat. 
Vervolgens wordt er een relatie gelegt tussen conditie (welke voedingsbodem) en de
experimenten. Er wordt aangegeven welke experimenten gelijk aan elkaar zijn gekeken 
naar de conditie, dus een groep glucose en ribose. <br> 
Output: een matrix Met als eerste kolom de namen van de experimenten. De tweede 
kolom bevat de conditie glucose en de derde kolom bevat de conditie ribose.
Vervolgens wordt er aangegeven hoeveel kolommen data bevatten. De kolommen met 
de condities hebben allebei een 1, dus niet alle waardes in de kolom zijn 0 in de
matrix. Als laatste wordt er voor gezorgd dat elk niveau met de basislijnniveau 
wordt gecontrasteerd.
```{r matrix aanmaken}
design <- model.matrix(~0+group, data=y$samples)
colnames(design) <- levels(y$samples$group)
print(design)
```


### Spreidingsbreedte Bepalen
Er wordt op drie verschillende manieren de spreidingsbreedte bepaald. De eerste
is de common, dit is de spreiding bepaald over alle waardes en daar het gemiddelde
van genomen. De tweede manier is om de spreiding te bepalen van het gemiddelde bij 
iedere waarde op de x-as en hier vervolgens een lijn van de maken. De derde manier
is dat er per experiment resultat een spreiding wordt bepaald, dus per gen. 
```{r iets}
y <- estimateGLMCommonDisp(y,design)
y <- estimateGLMTrendedDisp(y,design, method="power")
y <- estimateGLMTagwiseDisp(y,design)
```
### Grafieken Maken
De twee grafieken worden aangemaakt. De eerste grafiek is een multidimensionaal 
schaaldiagram van afstanden tussen genexpressieprofielen. De experimenten zijn 
op een tweedimensionale scatterplot geplot, zodat de afstanden op de plot de 
typische log2-voudige veranderingen tussen de experimenten benaderen. De tweede
grafiek is een plot welke biologische variatiecoëfficiënt toont. De genewise 
biologische variatiecoëfficiënt (BCV) zijn uitgezet tegen de overvloed aan genen
(in log2 tellingen per miljoen). <br>
Output: in het eerste grafiek als er gekeken wordt naar de eerste dimensie, is
te zien dat zowel glucose als ribose experimenten bijna dezelfde waarde hebben. 
Echter is er een groot verschil te zien in de waarde gekeken naar glucose ten 
opzichten van ribose. Dit betekend dat er spraken is van verschillende 
genexpressie. Als er gekeken wordt naar de tweede dimensie, is te zien dat de 
ribose experimenten dezelfde waarde hebben, maar dat de glucose experimenten 
verschillende waardes hebben. Echter is het verschil minder groot dan het 
verschil gekeken naar de eerste dimensie tussen glucose en ribose, Dus kan er 
met zekerheid gesteld worden dat er spraken is van verschil in genexpressie. 
In de tweede grafiek zijn de verschillende spreidingswaardes 
(variatiecoëfficiënt) getoont. De x-as geeft aan hoe vaak bepaald gen is geteld. 
De y-as geeft de mate van spreiding aan. 
```{r plot}
plotMDS(y)
plotBCV(y)
```

## Fit data
Op basis van de degin matrix en de samples, wordt er een model lijn (lineaire) 
gemaakt hoe de waardes zichtot elkaar verhouden. 
```{r fit data}
fit <- glmFit(y,design)
```

## Bepaal fold change
De input is het gemaakte model. Er wordt aangegeven wat er gemeten moet worden, 
dit is het verschil in genexpressie tussen glucose en ribose. Dit verschil is de 
fold change.Vervolgens wordt het model passende gemaakt en geef je het vorm. 
```{r bepalen fold change}
mc <- makeContrasts(exp.r=WCFS1.glc-WCFS1.rib, levels=design)
fit <- glmLRT(fit, contrast=mc)
```


## Beste resultaten weergeven
ALs laatste wordt het resultaat weergegeven, welke voortkomt uit het model.Er 
komt als resultaat een tabel met alle genen en de bijbehorende waardes uit. <br>
Output: de eerste kolom bevat de gen ID's. De tweede kolom bevat de log fold 
change waardes. De derde kolom bevat de verschillen in counts, dus hoe vaak gen
geteld is. De vierde kolom bevat ?????????(dit weet ik niet). De vijfde kolom 
bevat de p-waardes. Dit zijn de exact p-waarde voor differentiële expressie. 
De laatste kolom bevat de p-waarde aangepast voor meervoudige tests. Al de 
waardes hebben berekken tot het vergelijk van WCFS1.glc met WCFS1.rib.
```{r beste resultaten}
res<-topTags(fit)
print(res)
```

