model.matrix()
y
knitr::opts_chunk$set(echo = TRUE)
library(edgeR)
library(xlsx)
library(rstudioapi)
library(rafalib)
library(pathview)
library(ggplot2)
library(factoextra)
library(edgeR)
library(xlsx)
library(rstudioapi)
library(rafalib)
library(pathview)
library(ggplot2)
library(factoextra)
fDir <- selectDirectory(caption = "Select Directory")
fName <- "/RNA-Seq-counts.txt"
cnts <- read.delim(paste0(fDir,fName), comment.char="#")
row.names(cnts) <- cnts[,"ID"]
exp <- c("WCFS1.glc", "WCFS1.glc", "WCFS1.rib", "WCFS1.rib", "NC8.glc", "NC8.glc", "NC8.rib", "NC8.rib")
group <- factor(exp)
print(group)
print(summary(cnts[,2:9]))
y <- DGEList(counts=cnts[,2:9],group=group)
print(y)
y <- calcNormFactors(y, method="TMM")
lijst_norm_all <- y
print(summary(y$counts))
firstQuartile <- c()
for(i in 2:9) {
firstQuartile[i-1] <- unname(quantile(y$counts, .25))
}
highEnough <- y$counts > mean(firstQuartile)
keep <- rowSums(highEnough) >= 4
summary(keep)
y <- y[keep, keep.lib.sizes=FALSE]
print(y)
print(y$samples)
design <- model.matrix(~0+group, data=y$samples)
colnames(design) <- levels(y$samples$group)
print(design)
spreiding <- estimateDisp(y, design)
plotMDS(spreiding)
plotBCV(spreiding)
fit <- glmFit(spreiding,design)
mcWCFS1 <- makeContrasts(exp.r=WCFS1.glc-WCFS1.rib, levels=design)
fitWCFS1 <- glmLRT(fit, contrast=mcWCFS1)
mcNC8 <- makeContrasts(exp.r=NC8.glc-NC8.rib, levels=design)
fitNC8 <- glmLRT(fit, contrast=mcNC8)
Gen_nummer = c()
for (i in 0:length( fitWCFS1$table$logFC)){
Gen_nummer[i] <- i
}
data <- data.frame(fitWCFS1)
ggplot <- ggplot(data, aes(x = Gen_nummer, y = logFC))  + geom_point() + scale_y_continuous(breaks = round(seq(min(data), max(data), by = 0.5),0))
print(ggplot + ggtitle("MA plot WCFS1"))
Gen_nummer = c()
for (i in 0:length( fitNC8$table$logFC)){
Gen_nummer[i] <- i
}
data <- data.frame(fitNC8)
ggplot <- ggplot(data, aes(x = Gen_nummer, y = logFC))  + geom_point() + scale_y_continuous(breaks = round(seq(min(data), max(data), by = 0.5),0))
print(ggplot + ggtitle("MA plot NC8"))
print(topTags(fitWCFS1))
print(topTags(fitNC8))
resWCFS1<-topTags(fitWCFS1, n = length(fitWCFS1$fitted.values))
resNC8<-topTags(fitNC8, n = length(fitNC8$fitted.values))
dis_matrix <- dist(t(lijst_norm_all$counts[,1:8]), method = "euclidean")
hclust_object <- hclust(dis_matrix, method = "average")
plot(hclust_object)
km.res <- kmeans(dis_matrix, 4, nstart = 1)
fviz_cluster(km.res, data = dis_matrix, geom = "point")
km.res$cluster
km.res <- kmeans(y, 4, nstart = 1)
fviz_cluster(km.res, data = y, geom = "point")
resWCFS1 <- data.frame(resWCFS1)
attach(resWCFS1$table)
resWCFS1 <- subset(resWCFS1, (logFC > 1 | logFC < -1) & FDR < 0.001)
resNC8 <- data.frame(resNC8)
attach(resNC8$table)
resNC8 <- subset(resNC8, (logFC > 1 | logFC < -1) & FDR < 0.001)
logFC <- resWCFS1$logFC
names(logFC) <- row.names(resWCFS1)
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00010",  gene.idtype = "KEGG", out.suffix = "WCFS1.Glycolysis_Gluconeogenesis")
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00020",  gene.idtype = "KEGG", out.suffix = "WCFS1.CytrateCycle")
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00030",  gene.idtype = "KEGG", out.suffix = "WCFS1.PentosePhosphate")
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00190",  gene.idtype = "KEGG", out.suffix = "WCFS1.OxidativePhosphorilation")
logFC <- resNC8$logFC
names(logFC) <- row.names(resNC8)
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00010",  gene.idtype = "KEGG", out.suffix = "NC8.Glycolysis_Gluconeogenesis")
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00020",  gene.idtype = "KEGG", out.suffix = "NC8.CytrateCycle")
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00030",  gene.idtype = "KEGG", out.suffix = "NC8.PentosePhosphate")
pathview(gene.data = logFC, species = "lpl", pathway = "lpl00190",  gene.idtype = "KEGG", out.suffix = "NC8.OxidativePhosphorilation")
annotation = read.delim("WCFS1_anno.txt", header=TRUE, row.names = 1)
drops <- c("X","X.1","X.2","X.3", "X.4")
annotation <- annotation[ , !(names(annotation) %in% drops)]
resWCFS1 <- cbind(resWCFS1, annotation[rownames(resWCFS1),])
resNC8 <- cbind(resNC8, annotation[rownames(resNC8),])
write.xlsx(resWCFS1, paste0(fDir, "/foldChanges.xlsx"), sheetName = "WCFS1",
col.names = T, row.names = T, append = F)
write.xlsx(resNC8, paste0(fDir, "/foldChanges.xlsx"), sheetName = "NC8",
col.names = T, row.names = T, append = T)
write.xlsx(km.res$cluster, paste0(fDir, "/foldChanges.xlsx"), sheetName = "K-means Clustering",
col.names = F, row.names = T, append = T)
y
